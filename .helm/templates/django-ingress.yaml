apiVersion: {{ .Values.ingressApiVersion }}
kind: Ingress
metadata:
  name: {{ .Chart.Name }}-django-ingress
  annotations:
    # Size should be kept in sync with "client_max_body_size" in
    # config/templates/nginx/site.conf.tmpl.
    nginx.ingress.kubernetes.io/proxy-body-size: "2048m"
    nginx.ingress.kubernetes.io/proxy-read-timeout: "800"
    nginx.ingress.kubernetes.io/proxy-connect-timeout: "800"
spec:
  tls:
    - hosts:
      - {{ .Values.ingressHost }}
      {{ if .Values.tempIngressHost }}
      - {{ .Values.tempIngressHost }}
      {{ end }}
  rules:
    - host: {{ .Values.ingressHost }}
      http:
        paths:
          - path: /
            pathType: Prefix
            backend:
              {{ if (eq .Values.ingressApiVersion "networking.k8s.io/v1") }}
              service:
                name: {{ .Chart.Name }}-django-service
                port:
                  number: 8000
              {{ else }}
              serviceName: {{ .Chart.Name }}-django-service
              servicePort: 8000
              {{ end }}
    {{ if .Values.tempIngressHost }}
    - host: {{ .Values.tempIngressHost }}
      http:
        paths:
          - path: /
            pathType: Prefix
            backend:
              {{ if (eq .Values.ingressApiVersion "networking.k8s.io/v1") }}
              service:
                name: {{ .Chart.Name }}-django-service
                port:
                  number: 8000
              {{ else }}
              serviceName: {{ .Chart.Name }}-django-service
              servicePort: 8000
              {{ end }}
    {{ end }}
